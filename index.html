<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>Book</title>
<style>
  :root{
    --bg:#0b0b0b;
    --card:#1d1f23;
    --cardBorder:rgba(255,255,255,.08);
    --muted:rgba(255,255,255,.66);
    --ink:#fff;
    --accent:#1e8bff;
    --accentHover:#2a96ff;
    --line:rgba(255,255,255,.16);
    --lineActive:#1e8bff;
    --shadow:0 18px 48px rgba(0,0,0,.45);
    --radiusCard:26px;
    --t:.28s cubic-bezier(.2,.8,.2,1);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",Segoe UI,Roboto,Inter,system-ui,Arial,sans-serif;
    -webkit-font-smoothing:antialiased;
    color-scheme:dark;
  }

  .page{width:clamp(320px,92vw,420px); margin:0 auto; padding:22px 16px 40px;}
  h1{font-size:48px; line-height:1; margin:6px 4px 18px; font-weight:800; letter-spacing:-.4px}

  .card{
    position:relative; background:var(--card); border:1px solid var(--cardBorder);
    border-radius:var(--radiusCard); box-shadow:var(--shadow); padding:22px 20px 24px;
  }

  .grid{display:grid; grid-template-columns:1fr; row-gap:20px}
  .label{font-size:16px; color:var(--muted); margin:0 0 8px;}
  .row{position:relative}
  .line-wrap{position:relative; padding:0 0 12px;}
  .line-wrap::after{content:""; position:absolute; left:0; right:0; bottom:0; height:2px; background:var(--line); border-radius:2px;}
  .input, .select select{width:100%; background:transparent; border:0; outline:0; color:var(--ink); font-size:21px; padding:6px 34px 6px 0; line-height:1.25;}
  .input::placeholder{color:rgba(255,255,255,.55)}
  .focusbar{position:absolute; left:0; right:0; bottom:-1px; height:2px; background:var(--lineActive); transform:scaleX(0); transform-origin:left; transition:transform var(--t)}
  .input:focus ~ .focusbar, .select select:focus ~ .focusbar{transform:scaleX(1)}
  input[type="date"]{-webkit-appearance:none; appearance:none}
  input[type="date"]::-webkit-calendar-picker-indicator{opacity:0}
  .select{position:relative}
  .icon{position:absolute; right:0; top:50%; transform:translateY(-50%); width:20px; height:20px}
  .icon svg{width:100%; height:100%; display:block}
  .icon svg *{stroke:var(--accent); fill:none; stroke-width:1.9; stroke-linecap:round; stroke-linejoin:round}

  .swap{
    position:absolute; left:50%; top:-18px; transform:translateX(-50%);
    width:40px; height:40px; border-radius:50%;
    background:#2a2d33; border:1px solid var(--cardBorder);
    display:grid; place-items:center; box-shadow:0 6px 18px rgba(0,0,0,.34)
  }
  .swap svg{width:20px;height:20px}
  .swap svg path{stroke:var(--accent); fill:none; stroke-width:1.8; stroke-linecap:round; stroke-linejoin:round}

  .cta{margin-top:22px}
  .cta button{width:100%; height:60px; border-radius:34px; border:0; cursor:pointer; background:var(--accent); color:#fff; font-weight:800; font-size:24px; letter-spacing:.2px; box-shadow:0 12px 26px rgba(30,139,255,.33); transition:transform var(--t), background var(--t)}
  .cta button:hover{background:var(--accentHover)}
  .cta button:active{transform:translateY(1px)}

  /* ---------- OVERLAY ---------- */
  .backdrop{position:fixed; inset:0; background:rgba(0,0,0,.45); opacity:0; pointer-events:none; transition:opacity var(--t);}
  .backdrop.show{opacity:1; pointer-events:auto}
  .sheet{position:fixed; left:50%; transform:translate(-50%, 100%); bottom:0; width:min(420px,96vw); max-height:86vh; background:var(--card); border:1px solid var(--cardBorder); border-radius:28px 28px 0 0; box-shadow:0 -18px 48px rgba(0,0,0,.6); overflow:hidden; transition:transform var(--t)}
  .sheet.show{transform:translate(-50%,0)}
  .sheet-header{position:sticky; top:0; background:linear-gradient(180deg, rgba(0,0,0,.22), transparent 70%), var(--card); padding:14px 16px 8px; z-index:2; display:flex; align-items:center; justify-content:center;}
  .route-title{font-weight:800; letter-spacing:.4px}
  .btn-back{position:absolute; left:10px; top:10px; width:36px; height:36px; border-radius:50%; border:1px solid var(--cardBorder); background:#2a2d33; display:grid; place-items:center}
  .btn-back svg{width:18px;height:18px}

  .view{padding:12px 16px 22px; max-height:calc(86vh - 76px); overflow:auto; animation:fadeSlideIn .28s var(--t) both;}
  @keyframes fadeSlideIn {from{opacity:0; transform:translateY(12px)} to{opacity:1; transform:none}}

  .results{padding:10px 12px 18px;}
  .card-result{background:#22252a; border:1px solid rgba(255,255,255,.08); border-radius:18px; padding:16px 16px 14px; margin:12px 4px; box-shadow:0 8px 24px rgba(0,0,0,.35); transition:transform var(--t), box-shadow var(--t), background var(--t)}
  .card-result:active{transform:translateY(1px); box-shadow:0 6px 18px rgba(0,0,0,.28); background:#202228}
  .row-top{display:flex; align-items:center; justify-content:space-between; gap:8px}
  .pair{display:flex; align-items:baseline; gap:10px}
  .code{font-weight:800; letter-spacing:.6px; color:#ddd}
  .timepair{font-size:20px; font-weight:800; letter-spacing:.2px}
  .plus1{font-size:14px; color:var(--muted); margin-left:2px}
  .right-price{font-weight:800; font-size:20px; color:#2ea0ff; display:flex; align-items:center; gap:6px}
  .row-mid{color:var(--muted); margin:6px 0 0; display:flex; gap:14px; font-size:15px}
  .row-foot{margin-top:10px; padding-top:10px; border-top:1px solid rgba(255,255,255,.06); display:flex; align-items:center; gap:8px; color:#ffcc66; font-size:14px}
  .row-foot.hide{display:none}

  .panel{background:#23262c; border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:14px 14px 12px; margin:10px 0; box-shadow:0 8px 22px rgba(0,0,0,.32)}
  .panel h3{margin:0 0 8px; font-size:20px}
  .kv{display:flex; justify-content:space-between; margin:6px 0; color:#cfd6dd; gap:12px}
  .kv b{color:#fff}
  .btn-lg{width:100%; height:56px; border-radius:30px; border:0; background:var(--accent); color:#fff; font-weight:800; font-size:20px; box-shadow:0 10px 24px rgba(30,139,255,.33); cursor:pointer; transition:transform var(--t), background var(--t)}
  .btn-lg:active{transform:translateY(1px)}

  .info{background:#1d3a54; border:1px solid rgba(67,153,255,.4)}
  .info .title{font-weight:800; margin-bottom:8px}
  .muted{color:#aab2ba}

  .form-row{display:grid; gap:12px; grid-template-columns:1fr; width:100%}
  .form-row.half{grid-template-columns:repeat(2, minmax(0,1fr))}
  @media (max-width: 360px){ .form-row.half{grid-template-columns:1fr} }
  .field{display:flex; flex-direction:column; gap:6px; min-width:0}
  .field label{color:#c8ced6; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
  .field input, .field select{width:100%; max-width:100%; background:#121317; color:#fff; border:1px solid rgba(255,255,255,.16); border-radius:12px; padding:12px 12px; font-size:16px; outline:none; -webkit-appearance:none; appearance:none;}
  .agree{display:flex; align-items:flex-start; gap:10px; margin:12px 0 8px; color:#cfd6dd}
  .agree input{margin-top:4px}

  @media (min-width:480px){ .sheet, .page{width:420px} }

  .hr{height:1px;background:rgba(255,255,255,.14); margin:8px 0}

  :root { --priceGreen:#63d488; }

  .gf-head{display:flex;align-items:center;justify-content:space-between}
  .gf-times{font-size:20px;font-weight:800;letter-spacing:.2px}
  .gf-times .arrow{opacity:.6;margin:0 8px}
  .gf-times sup{font-size:12px; color:var(--muted); margin-left:4px}
  .gf-iata{margin-top:2px;font-size:12px;color:#9aa3af;letter-spacing:.2px}
  .gf-meta{margin-top:6px;font-size:14px;color:#cfd6dd}
  .gf-meta .dot{opacity:.6;margin:0 6px}
  .gf-carrier{margin-top:2px;font-size:14px;color:#aab2ba}
  .gf-price{font-weight:800;font-size:20px;color:var(--priceGreen)}
  .gf-overnight{margin-top:8px;color:#ffcc66;font-size:14px;display:flex;align-items:center;gap:6px}

  /* ---- Processing / Confirmation bits ---- */
  .processing { display:grid; gap:14px; place-items:center; padding:40px 8px; text-align:center; }
  .spinner { width:52px; height:52px; border-radius:50%; border:4px solid rgba(255,255,255,.18); border-top-color: var(--accent); animation: spin 1s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }

  .glass { background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.14); border-radius: 18px; padding:16px 14px 12px; box-shadow: 0 10px 28px rgba(0,0,0,.35); backdrop-filter: blur(6px); }

  .check-wrap{ width:72px;height:72px; border-radius:50%; background: rgba(68, 185, 119, .15); display:grid; place-items:center; margin:0 auto 10px; border:1px solid rgba(68,185,119,.25); }
  .check-wrap svg{width:40px;height:40px}
  .check-wrap svg *{stroke:#63d488; stroke-width:3; fill:none; stroke-linecap:round; stroke-linejoin:round}

  .confirm-title{font-weight:800; font-size:20px; text-align:center; margin:6px 0 2px}
  .confirm-sub{color:#cfd6dd; text-align:center; margin-bottom:10px}

  .badge { display:inline-block; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.07); border:1px solid rgba(255,255,255,.12); font-weight:700; letter-spacing:.3px; }
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;}

  .icon { pointer-events: none; }
  .select .icon { pointer-events: none; }
  .swap { pointer-events: none; }

  .select select {
    position: relative;
    z-index: 1;
    -webkit-appearance: none;
    appearance: none;
  }

  /* modal layer order + lock the page when sheet is open */
.backdrop { z-index: 999; }
.sheet    { z-index: 1000; }

.modal-open { overflow: hidden; }        /* no background scroll */
.modal-open .page { pointer-events: none; } /* no background taps/clicks */

  /* ---- Bottom Dock (tabs) ---- */
.dock{
  position:fixed;
  left:50%;
  bottom:calc(12px + env(safe-area-inset-bottom));
  transform:translateX(-50%);
  display:grid;
  grid-auto-flow:column;
  grid-auto-columns:1fr;
  gap:6px;
  padding:6px;
  width:min(360px, 92vw);
  border-radius:999px;
  background:rgba(20,22,26,.72);
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 10px 30px rgba(0,0,0,.45);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
  z-index:5; /* stays under the sheet/backdrop */
}
.dock-item{
  position:relative; z-index:1;
  display:flex; align-items:center; justify-content:center; gap:8px;
  height:44px; padding:0 16px;
  border:0; background:transparent; cursor:pointer;
  color:var(--muted); font-weight:800; letter-spacing:.2px;
  border-radius:999px; transition:color var(--t);
}
.dock-item.active{ color:#fff; }
.dock-item svg{width:18px; height:18px}
.dock-item svg *{stroke:currentColor; fill:none; stroke-width:2; stroke-linecap:round; stroke-linejoin:round}

/* sliding highlight “pill” */
.dock-indicator{
  position:absolute; top:6px; bottom:6px; left:6px;
  width:calc(50% - 3px);  /* two tabs → half width */
  border-radius:999px;
  background:rgba(30,139,255,.18);
  border:1px solid rgba(30,139,255,.45);
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.06);
  transform:translateX(0%); transition:transform var(--t);
  will-change:transform;
}

/* (optional) make sure sheet/backdrop are above the dock */
.backdrop{ z-index:40; }
.sheet{ z-index:50; }

  /* Screens + simple fade/slide transition */
.screen{
  opacity:0; transform:translateY(8px);
  transition:opacity var(--t), transform var(--t);
}
.screen.show{ opacity:1; transform:none; }

/* small section header for "Previous Trips" */
.subhead{ font-size:20px; font-weight:800; margin:8px 4px 0; }

  .gf-times{font-size:18px; line-height:1.15; font-weight:800; letter-spacing:.2px}
  .gf-times sup{font-size:11px}

  /* Airline logo row */
.row-mid{
  display:flex; align-items:center; gap:10px;
  color:var(--muted); margin:6px 0 0; font-size:15px;
}
.airlogo{
  width:22px; height:22px; object-fit:contain; flex:0 0 22px;
  filter: drop-shadow(0 1px 0 rgba(0,0,0,.35));
}
.airlogo.is-u2{ width:26px; height:26px; }  /* easyJet slightly bigger */
.row-mid-text .carrier-line{ color:#cfd6dd; font-size:14px; margin-top:2px; }

  /* ------- Trips page ------- */
.subhead{font-size:22px;font-weight:800;margin:14px 4px 10px}
.trip-list{display:grid;gap:12px;padding:0 4px 24px}
.trip-card{
  display:flex;gap:12px;align-items:center;
  background:#202329;border:1px solid rgba(255,255,255,.10);
  border-radius:16px;padding:12px 12px;box-shadow:0 8px 22px rgba(0,0,0,.32);
  transition:transform var(--t), box-shadow var(--t), background var(--t)
}
.trip-card:active{transform:translateY(1px);box-shadow:0 6px 18px rgba(0,0,0,.28);background:#1f2127}
.trip-logo{width:34px;height:34px;border-radius:8px;object-fit:contain;background:#13151a;display:block}
.trip-body{display:grid;gap:4px;min-width:0}
.trip-times{font-size:18px;font-weight:800;letter-spacing:.2px}
.trip-route{font-size:13px;color:#aab2ba}
.trip-date{font-size:12px;color:#8f99a4}

.pill{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:700;letter-spacing:.3px}
.pill-ontime{background:rgba(33,208,122,.15);border:1px solid rgba(33,208,122,.35);color:#63d488}
.pill-inflight{background:rgba(67,153,255,.15);border:1px solid rgba(67,153,255,.33);color:#2ea0ff}
.pill-arrived{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.16);color:#d9dee3}

.t-early{color:#63d488}
.t-late{color:#ff6b6b}

/* small action sheet used by Status button */
.actions-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);opacity:0;pointer-events:none;transition:opacity var(--t)}
.actions-backdrop.show{opacity:1;pointer-events:auto}
.actions{
  position:fixed;left:50%;bottom:0;transform:translate(-50%,20px);
  width:min(420px,96vw);background:var(--card);border:1px solid var(--cardBorder);
  border-radius:18px 18px 0 0;box-shadow:0 -16px 36px rgba(0,0,0,.55);padding:10px 12px 12px;
  transition:transform var(--t)
}
.actions.show{transform:translate(-50%,0)}
.actions .btn{width:100%;height:48px;border:0;border-radius:12px;background:#2a2d33;color:#fff;font-weight:700;margin:6px 0}
.actions .btn.red{background:#5a1e1e}
.actions .row{display:grid;gap:8px;margin:8px 0}
.actions input[type="time"], .actions input[type="text"]{
  width:100%;background:#121317;border:1px solid rgba(255,255,255,.16);color:#fff;border-radius:12px;padding:10px 12px;font-size:16px
}

/* Trips page container (hidden when on booking) */
#pageTrips[hidden]{display:none}

  /* ---- Trip detail (full page) ---- */
.btn-page-back{
  position:absolute; left:12px; top:12px; width:36px; height:36px;
  border-radius:50%; border:1px solid var(--cardBorder);
  background:#2a2d33; display:grid; place-items:center; z-index:2
}
.btn-page-back svg{width:18px;height:18px}

.td-topnote{color:#9aa3af; font-size:12px; margin:0 4px 4px}
.td-title{font-size:44px; font-weight:800; letter-spacing:.3px; margin:22px 4px 12px}
@media (max-width:380px){ .td-title{font-size:38px} }

.td-card{
  background:#202329; border:1px solid rgba(255,255,255,.10);
  border-radius:18px; padding:14px 14px 12px; margin:10px 0;
  box-shadow:0 8px 22px rgba(0,0,0,.32);
}
.td-airlineRow{display:flex; align-items:center; justify-content:space-between; gap:12px}
.td-left{display:flex; align-items:center; gap:12px}
.td-logo{width:40px; height:40px; border-radius:10px; background:#13151a; object-fit:contain}
.td-airlineName{font-weight:800; font-size:18px}
.td-route{font-size:13px; color:#aab2ba}

/* reuse your .kv rows */

  /* small action sheet used by Status button */
.actions-backdrop{
  position:fixed; inset:0;
  background:rgba(0,0,0,.45);
  opacity:0; pointer-events:none; transition:opacity var(--t);
  z-index:1100;                    /* ABOVE the dock */
}
.actions-backdrop.show{ opacity:1; pointer-events:auto }

.actions{
  position:fixed; left:50%; bottom:0;
  transform:translate(-50%, 100%); /* start fully off-screen */
  width:min(420px,96vw);
  background:var(--card); border:1px solid var(--cardBorder);
  border-radius:18px 18px 0 0; box-shadow:0 -16px 36px rgba(0,0,0,.55);
  padding:10px 12px calc(12px + env(safe-area-inset-bottom)); /* clear iOS bar */
  transition:transform var(--t);
  z-index:1101;                    /* ABOVE the backdrop & dock */
}
.actions.show{ transform:translate(-50%, 0) }

.actions .btn{ width:100%; height:48px; border:0; border-radius:12px;
  background:#2a2d33; color:#fff; font-weight:700; margin:6px 0 }
.actions .btn.red{ background:#5a1e1e }

.actions .row{ display:grid; gap:8px; margin:8px 0 }
.actions input[type="time"], .actions input[type="text"]{
  width:100%; background:#121317; border:1px solid rgba(255,255,255,.16);
  color:#fff; border-radius:12px; padding:10px 12px; font-size:16px
}

/* also block taps on the dock while any modal/action is open */
.modal-open .dock{ pointer-events:none; }

  /* ---- Delete button in archived cards ---- */
.trip-right{ margin-left:auto; display:grid; gap:6px; align-items:center; justify-items:end }
.mini-btn{
  height:32px; padding:0 12px; border-radius:10px; border:1px solid rgba(255,255,255,.14);
  background:#2a2d33; color:#fff; font-weight:700; cursor:pointer; transition:transform var(--t), background var(--t)
}
.mini-btn.red{ background:#5a1e1e; border-color:rgba(255,99,99,.45) }
.mini-btn:active{ transform:translateY(1px) }

/* ---- Centered confirm dialog ---- */
.confirm-backdrop{
  position:fixed; inset:0; background:rgba(0,0,0,.5);
  opacity:0; pointer-events:none; transition:opacity var(--t); z-index:1200;
}
.confirm-backdrop.show{ opacity:1; pointer-events:auto }

.confirm{
  position:fixed; left:50%; top:50%;
  transform:translate(-50%,-40%) scale(.96); opacity:0;
  width:min(420px, 90vw); background:var(--card); border:1px solid var(--cardBorder);
  border-radius:16px; box-shadow:0 20px 60px rgba(0,0,0,.6);
  padding:16px; transition:transform var(--t), opacity var(--t); z-index:1201;
}
.confirm.show{ transform:translate(-50%,-50%) scale(1); opacity:1 }
.confirm h3{ margin:6px 0 4px; font-size:18px; font-weight:800 }
.confirm p{ margin:0 0 12px; color:#cfd6dd }
.confirm .row-btns{ display:flex; gap:10px; margin-top:10px }
.btn-outline{
  flex:1; height:44px; border-radius:12px; border:1px solid rgba(255,255,255,.18);
  background:#2a2d33; color:#fff; font-weight:700; cursor:pointer;
}
.btn-danger{
  flex:1; height:44px; border-radius:12px; border:1px solid rgba(255,99,99,.45);
  background:#5a1e1e; color:#fff; font-weight:800; cursor:pointer;
}

/* block dock while any modal is open (you already have .modal-open for sheets) */
.modal-open .dock{ pointer-events:none; }

  /* ---- Trip detail (large-times design) ---- */
.tdetail .updated{color:#8f99a4;font-size:12px;margin:2px 4px 12px}
.tdetail .route{font-size:40px;line-height:1.05;font-weight:800;letter-spacing:.4px;margin:0 4px 14px}

.tcard{
  background:#202329;border:1px solid rgba(255,255,255,.10);
  border-radius:20px;padding:14px 14px;box-shadow:0 10px 28px rgba(0,0,0,.35);
  margin:10px 0
}
.trow{display:flex;align-items:center;gap:12px}
.trow .airline{font-weight:800;font-size:20px}
.trow .sub{color:#aab2ba;font-size:13px;margin-top:2px}
.trow .pill{margin-left:auto}

.section{padding:14px 14px 12px}
.airport{font-weight:700}
.airport small{color:#9aa3af;font-weight:600}
.bigtime{font-size:44px;line-height:1.02;font-weight:900;letter-spacing:.4px;margin:8px 0 0}
.sched-old{margin-left:10px;text-decoration:line-through;opacity:.45;font-weight:700}
.delta{font-weight:800;margin-top:4px}
.delta.late{color:#ff6b6b}
.delta.early{color:#63d488}

.tfooter{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
.tfooter .kv{margin:0}

/* gate badge + terminal label */
.headrow{display:flex;align-items:center;justify-content:space-between}
.gatebox{display:flex;flex-direction:column;align-items:flex-end;gap:4px}
.gatepill{
  display:inline-block; padding:6px 10px; border-radius:10px;
  background:#ffd54a; color:#111; font-weight:900; letter-spacing:.2px;
}
.term{font-size:12px; color:#cfd6dd}

/* color the NEW time when early/late (not the crossed-out one) */
.time-early{color:#63d488; font-weight:900}
.time-late {color:#ff6b6b; font-weight:900}

</style>
</head>
<body>
  <main id="screen-booking" class="page screen show">
    <h1>Book</h1>

    <section class="card" aria-label="Flight Search">
      <div class="swap" aria-hidden="true">
        <svg viewBox="0 0 24 24"><path d="M3 7h12"></path><path d="M10 3l5 4-5 4"></path><path d="M21 17H9"></path><path d="M14 21l-5-4 5-4"></path></svg>
      </div>

      <div class="grid">
        <div class="row">
          <div class="label">From</div>
          <div class="line-wrap select">
            <select id="from" aria-label="From">
              <option value="" selected disabled>City / airport</option>
            </select>
            <div class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M4.5 12.8l14.6-8.75c.5-.3 1.1.23.83.76L13.6 20.9a.7.7 0 0 1-1.31-.06l-1.24-5.17-5.17-1.24a.7.7 0 0 1 .06-1.31z"></path></svg>
            </div>
            <div class="focusbar"></div>
          </div>
        </div>

        <div class="row">
          <div class="label">To</div>
          <div class="line-wrap select">
            <select id="to" aria-label="To">
              <option value="" selected disabled>City / airport</option>
            </select>
            <div class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M4.5 12.8l14.6-8.75c.5-.3 1.1.23.83.76L13.6 20.9a.7.7 0 0 1-1.31-.06l-1.24-5.17-5.17-1.24a.7.7 0 0 1 .06-1.31z"></path></svg>
            </div>
            <div class="focusbar"></div>
          </div>
        </div>

        <div class="row">
          <div class="label">Depart</div>
          <div class="line-wrap">
            <input id="depart" class="input" type="date" aria-label="Depart date" />
            <div class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="16" rx="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="8" y1="3" x2="8" y2="7"></line><line x1="16" y1="3" x2="16" y2="7"></line></svg>
            </div>
            <div class="focusbar"></div>
          </div>
        </div>
        
        <div class="row">
          <div class="label">Return</div>
          <div class="line-wrap">
            <input id="return" class="input" type="date" aria-label="Return date (ignored for one-way)" />
            <div class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="16" rx="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="8" y1="3" x2="8" y2="7"></line><line x1="16" y1="3" x2="16" y2="7"></line></svg>
            </div>
            <div class="focusbar"></div>
          </div>
        </div>

        <div class="row">
          <div class="label">Passengers</div>
          <div class="line-wrap select">
            <select id="pax" aria-label="Passengers">
              <option selected>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option><option>6</option>
            </select>
            <div class="focusbar"></div>
          </div>
        </div>
      </div>

      <div class="cta"><button id="btnSearch" type="button">Search</button></div>
    </section>
  </main>

  <div class="backdrop" id="backdrop"></div>
  <section class="sheet" id="sheet" aria-modal="true" role="dialog">
    <div class="sheet-header">
      <button class="btn-back" id="btnBack" aria-label="Back">
        <svg viewBox="0 0 24 24"><path d="M15 6l-6 6 6 6" stroke="#9aa3af" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <div class="route-title" id="routeTitle">RFD – PER</div>
    </div>
    <div id="sheetBody" class="view"></div>
  </section>

  <main id="screen-trips" class="page screen" style="display:none">
  <h1>Upcoming Trips</h1>
  <div id="upcomingEmpty" class="muted" style="margin:2px 4px 12px">No upcoming trips</div>
  <div id="upcomingList" class="trip-list"></div>

  <div class="hr" style="margin:12px 0"></div>
  <div class="subhead">Previous Trips</div>
  <div id="previousList" class="trip-list"></div>
</main>

  <main id="screen-trip-detail" class="page screen" style="display:none"></main>

  <nav class="dock" id="dock" aria-label="Tabs">
  <span class="dock-indicator" aria-hidden="true"></span>

  <button class="dock-item active" data-tab="booking" aria-current="page">
    <!-- airplane-ish icon (matches your style) -->
    <svg viewBox="0 0 24 24">
      <path d="M4.5 12.8l14.6-8.75c.5-.3 1.1.23.83.76L13.6 20.9a.7.7 0 0 1-1.31-.06l-1.24-5.17-5.17-1.24a.7.7 0 0 1 .06-1.31z"></path>
    </svg>
    <span>Booking</span>
  </button>

  <button class="dock-item" data-tab="trips">
    <!-- “list/ticket” style icon -->
    <svg viewBox="0 0 24 24">
      <rect x="3" y="4" width="18" height="16" rx="3"></rect>
      <path d="M7 8h10M7 12h10M7 16h7"></path>
    </svg>
    <span>Trips</span>
  </button>
</nav>

<script>
/* -------------------- Airports + form behavior -------------------- */
const AIRPORTS = [
  { code:'RFD', name:'Rockford Intl Airport (RFD)' },
  { code:'MLR', name:'Mellor Regional Airport (MLR)' },
  { code:'PER', name:'Perth Intl Airport (PER)' },
  { code:'IZO', name:'Izolirani Intl Airport (IZO)' },
  { code:'LCA', name:'Larnaca Intl Airport (LCA)' },
  { code:'PHP', name:'Phaphos Regional Airport (PHP)' },
  { code:'HND', name:'Tokyo Haneda Intl (HND)' },
  { code:'GRV', name:'Grindavik Intl Airport (GRV)' },
  { code:'SAU', name:'Sauthemptona Airport (SAU)' }
];

let passengerData = {};
function randDigits(n){ let s=''; for(let i=0;i<n;i++) s += Math.floor(Math.random()*10); return s; }
function formatDate(iso){ if(!iso) return ''; const d=new Date(iso); return d.toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'}); }

const fromSel = document.getElementById('from');
const toSel   = document.getElementById('to');

function fillSelect(selectEl, excludeCode) {
  const current = selectEl.value;
  selectEl.innerHTML = '<option value="" disabled selected>City / airport</option>';
  AIRPORTS.forEach(a => {
    if (a.code !== excludeCode) {
      const opt = document.createElement('option');
      opt.value = a.code; opt.textContent = a.name;
      selectEl.appendChild(opt);
    }
  });
  if (current && current !== excludeCode) {
    const exists = Array.from(selectEl.options).some(o => o.value === current);
    if (exists) selectEl.value = current;
  }
}
fillSelect(fromSel);
fillSelect(toSel);
fromSel.addEventListener('change', () => fillSelect(toSel, fromSel.value || null));
toSel  .addEventListener('change', () => fillSelect(fromSel, toSel.value || null));

/* -------------------- Overlay + transitions -------------------- */
const backdrop = document.getElementById('backdrop');
const sheet = document.getElementById('sheet');
const btnBack = document.getElementById('btnBack');
const sheetBody = document.getElementById('sheetBody');
const routeTitle = document.getElementById('routeTitle');
let stepStack = [];

function openSheet(){
  backdrop.classList.add('show');
  sheet.classList.add('show');
  document.body.classList.add('modal-open');
}

function closeSheet(){
  sheet.classList.remove('show');
  backdrop.classList.remove('show');
  document.body.classList.remove('modal-open');
  stepStack = [];
}
  
btnBack.addEventListener('click', () => {
  if (stepStack.length <= 1) { closeSheet(); return; }
  stepStack.pop();
  const prev = stepStack[stepStack.length-1];
  renderView(prev.title, prev.html);
});

/* -------------------- Utilities -------------------- */
function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
function shuffle(arr){ return arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(p=>p[1]); }
function randomUniqueTimes(n){ const s=new Set(); while(s.size<n) s.add(randInt(0,1439)); return [...s]; }
function minutesToTime(mins){
  mins = ((mins % (24*60)) + (24*60)) % (24*60);
  const h24 = Math.floor(mins/60), m = mins % 60;
  const h12 = ((h24 + 11) % 12) + 1;
  const ampm = h24 < 12 ? 'AM' : 'PM';
  return `${h12}:${m.toString().padStart(2,'0')} ${ampm}`;
}
function overnightFlag(depMins, arrMins){ const w=t=>t>=0&&t<360; return w(depMins%1440)||w(arrMins%1440); }

/* Airline codes (used on Review & Pay) */
const AIRLINE_CODES = {
  'American Airlines':'AA','JetBlue':'B6','Delta':'DL','United':'UA','Southwest':'WN','Spirit':'NK',
  'Emirates':'EK','Singapore':'SQ','Lufthansa':'LH','SWISS':'LX','Korean Air':'KE','KLM':'KL','Qatar Airways':'QR','Air France':'AF','Qantas':'QF','CEBU Pacific':'5J','British Airways':'BA','Condor':'DE','easyJet':'U2'
};

/* Airline logos in / (repo root). Adjust filenames if your paths differ */
const LOGO_MAP = {
  'JetBlue':'jb-icon.png',
  'American Airlines':'aa-icon.png',
  'Delta':'dl-icon.png',
  'United':'ua-icon.png',
  'Southwest':'wn-icon.png',
  'Spirit':'nk-icon.png',
  'Emirates':'ek-icon.png',
  'Singapore':'sq-icon.png',
  'Lufthansa':'lh-icon.png',
  'SWISS':'lx-icon.png',
  'Korean Air':'ke-icon.png',
  'KLM':'kl-icon.png',
  'Qatar Airways':'qr-icon.png',
  'Air France':'af-icon.png',
  'Qantas':'qf-icon.png',
  'CEBU Pacific':'5J-icon.png',
  'British Airways':'ba-icon.png',
  'Condor':'de-icon.png',
  'easyJet':'U2-icon.png'
};
const logoFor = carrier => LOGO_MAP[carrier] ? `./${LOGO_MAP[carrier]}` : '';

/* very small localStorage wrapper */
const getTrips = () => { try { return JSON.parse(localStorage.getItem('trips')||'[]'); } catch(e){ return []; } };
const setTrips = (arr) => localStorage.setItem('trips', JSON.stringify(arr));
const saveTrip = (trip) => { const arr=getTrips(); arr.unshift(trip); setTrips(arr); };

/* time parsing for comparisons ("10:02 PM" → minutes) */
function timeStrToMins(s){
  if(!s) return 0;
  const m=s.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i); if(!m) return 0;
  let h=+m[1]%12, min=+m[2]; const pm=/PM/i.test(m[3]); if(pm) h+=12; return h*60+min;
}

/* Country mapping for INTL check */
function countryOf(code){
  if (['RFD','PER','LCA','PHP','MLR','IZO'].includes(code)) return 'US';
  if (['HND','GRV','SAU'].includes(code)) return 'JP';
  return 'US';
}
function isIntl(a,b){ return countryOf(a) !== countryOf(b); }

/* -------------------- Aircraft rules -------------------- */
const AIRCRAFT_RULES = {
  'PER-RFD': {
    'American Airlines':['A320','B737'],
    'JetBlue':['A320'],
    'Spirit':['A320'],
    'Delta':['A320'],
    'United':['A320','B737'],
    'Southwest':['B737']
  },
  'IZO-RFD': {
    'American Airlines':['B737','A320','B777'],
    'JetBlue':['A320'],
    'Southwest':['B737'],
    'Delta':['A320']
  },
  'LCA-RFD': {
    'JetBlue':['A320'],
    'Delta':['A320','B737','B757','CRJ700'],
    'Southwest':['B737'],
    'American Airlines':['A320','B737'],
    'United':['A320','B737']
  },
  'PHP-RFD': {
    'JetBlue':['A320'],
    'Delta':['A320'],
    'United':['A320'],
    'Southwest':['B737'],
    'American Airlines':['A320']
  },
  'HND-RFD': {
    'Lufthansa':['A350','A380','B747'],
    'Delta':['A350','B757'],
    'Emirates':['A380','B777','A350'],
    'Singapore':['A350','B777'],
    'British Airways':['B777', 'A380', 'A350'],
    'American Airlines':['B777','B787'],
    'KLM':['B777'],
    'SWISS':['A330','B777'],
    'Korean Air':['A380'],
    'Qatar Airways':['B777','A350','A380'],
    'Air France':['B777']
  },
  'MLR-RFD': {
    'American Airlines':['CRJ700','E190'],
    'JetBlue':['A320'],
    'United':['CRJ700','E190']
  },
  'GRV-RFD': {
    'United': ['B787']
  },
  'IZO-PER': {
    'American Airlines': ['CRJ700', 'E190']
  },
  'MLR-PER': {
    'American Airlines': ['A320', 'B737'],
    'JetBlue': ['A320'],
    'Southwest': ['B737'],
    'Delta': ['A320'],
    'United': ['A320', 'B737']
  },
  'LCA-PER': {
    'American Airlines': ['A320', 'B737'],
    'Delta': ['A320', 'B757', 'B737'],
    'Spirit': ['A320'],
    'United': ['A320']
  },
  'PER-PHP': {
    'American Airlines': ['A320', 'B737'],
    'Delta': ['A320'],
    'United': ['A320'],
    'Spirit': ['A320'],
    'Southwest': ['B737']
  },
  'GRV-PER': {
    'Qantas': ['A350']
  },
  'IZO-MLR': {
    'American Airlines': ['A320', 'B737'],
    'United': ['A320'],
    'Delta': ['A320']
  },
  'LCA-MLR': {
    'Delta': ['A320', 'B737'],
    'United': ['A320'],
    'Spirit': ['A320'],
    'American Airlines': ['A320']
  },
  'MLR-PHP': {
    'American Airlines': ['A320'],
    'United': ['A320', 'B737'],
    'Delta': ['A320']
  },
  'IZO-LCA': {
    'American Airlines': ['A320', 'B737'],
    'Delta': ['A320'],
    'United': ['A320']
  },
  'IZO-PHP': {
    'American Airlines': ['A320', 'B737'],
    'Spirit': ['A320']
  },
  'HND-IZO': {
    'American Airlines': ['B777']
  },
  'GRV-IZO': {
    'Lufthansa': ['A350']
  },
  'LCA-PHP': {
    'Delta': ['CRJ700', 'E190']
  },
  'HND-LCA': {
    'Delta': ['A350'],
    'Singapore': ['A350'],
    'Emirates': ['A380']
  },
  'GRV-LCA': {
    'Delta': ['A350']
  },
  'GRV-HND': {
    'Lufthansa': ['A320'],
    'CEBU Pacific': ['A320'],
    'British Airways': ['A320'],
    'Qatar Airways': ['A320'],
    'Condor': ['A320'],
    'easyJet': ['A320']
  },
  'HND-SAU': {
    'SWISS': ['A320'],
    'Qatar Airways': ['A320'],
    'Lufthansa': ['A320'],
    'British Airways': ['A320'],
    'Condor': ['A320']
  },
  'GRV-SAU': {
    'SWISS': ['A320'],
    'easyJet': ['A320']
  }
};

function routeKey(a,b){ return [a,b].sort().join('-'); }
function pickAircraft(fromCode,toCode,carrier){
  const rules = AIRCRAFT_RULES[routeKey(fromCode,toCode)];
  if(!rules || !rules[carrier] || rules[carrier].length===0) return '';
  const list = rules[carrier];
  return list[randInt(0, list.length-1)];
}

/* -------------------- Route builders (NONSTOP ONLY) -------------------- */
function buildRfdPerResults(from,to){
  const carriers=['American Airlines','JetBlue',...shuffle(['United','Spirit','Southwest','Delta'])];
  const depTimes=randomUniqueTimes(6);
  const durations=Array.from({length:6},()=>randInt(120,180));
  const allPrices=Array.from({length:6},()=>randInt(250,600));
  const sorted=[...allPrices].sort((a,b)=>a-b), cheap1=sorted[0], cheap2=sorted[1];
  const rest=[...allPrices]; let i=rest.indexOf(cheap1); if(i>-1)rest.splice(i,1); i=rest.indexOf(cheap2); if(i>-1)rest.splice(i,1);
  const prices=[cheap1,cheap2,...rest];
  return carriers.map((c,idx)=>{const d=depTimes[idx],du=durations[idx],a=d+du;return{
    from,to,depart:minutesToTime(d),arrive:minutesToTime(a),
    plusOne:Math.floor(a/1440)>Math.floor(d/1440)?'+1':'',
    durationMin:du,durationText:`${Math.floor(du/60)}h ${String(du%60).padStart(2,'0')}m`,
    nonstop:true,price:prices[idx],carrier:c,overnight:overnightFlag(d,a),
    aircraft: pickAircraft(from,to,c)
  }});
}

function buildRfdIzoResults(from,to){
  const carriers=['American Airlines','American Airlines','JetBlue',...shuffle(['JetBlue','Southwest','Delta'])];
  const depTimes=randomUniqueTimes(6), durations=Array.from({length:6},()=>randInt(120,180)), prices=Array.from({length:6},()=>randInt(250,600));
  return carriers.map((c,idx)=>{const d=depTimes[idx],du=durations[idx],a=d+du;return{
    from,to,depart:minutesToTime(d),arrive:minutesToTime(a),
    plusOne:Math.floor(a/1440)>Math.floor(d/1440)?'+1':'',
    durationMin:du,durationText:`${Math.floor(du/60)}h ${String(du%60).padStart(2,'0')}m`,
    nonstop:true,price:prices[idx],carrier:c,overnight:overnightFlag(d,a),
    aircraft: pickAircraft(from,to,c)
  }});
}

function buildRfdLcaResults(from,to){
  const carriers=['JetBlue','Delta','Delta',...shuffle(['American Airlines','Southwest','United'])];
  const depTimes=randomUniqueTimes(6), durations=Array.from({length:6},()=>randInt(90,120)), prices=Array.from({length:6},()=>randInt(250,550));
  return carriers.map((c,idx)=>{const d=depTimes[idx],du=durations[idx],a=d+du;return{
    from,to,depart:minutesToTime(d),arrive:minutesToTime(a),
    plusOne:Math.floor(a/1440)>Math.floor(d/1440)?'+1':'',
    durationMin:du,durationText:`${Math.floor(du/60)}h ${String(du%60).padStart(2,'0')}m`,
    nonstop:true,price:prices[idx],carrier:c,overnight:overnightFlag(d,a),
    aircraft: pickAircraft(from,to,c)
  }});
}

function buildRfdPhpResults(from,to){
  const carriers=['JetBlue','JetBlue','Delta',...shuffle(['American Airlines','United','Southwest'])];
  const depTimes=randomUniqueTimes(6), durations=Array.from({length:6},()=>randInt(90,120)), prices=Array.from({length:6},()=>randInt(250,550));
  return carriers.map((c,idx)=>{const d=depTimes[idx],du=durations[idx],a=d+du;return{
    from,to,depart:minutesToTime(d),arrive:minutesToTime(a),
    plusOne:Math.floor(a/1440)>Math.floor(d/1440)?'+1':'',
    durationMin:du,durationText:`${Math.floor(du/60)}h ${String(du%60).padStart(2,'0')}m`,
    nonstop:true,price:prices[idx],carrier:c,overnight:overnightFlag(d,a),
    aircraft: pickAircraft(from,to,c)
  }});
}

/* RFD ↔ HND (Tokyo) */
function buildRfdHndResults(fromCode, toCode){
  const firstSix = shuffle(['American Airlines','Delta','Emirates','Singapore','British Airways','Lufthansa']);
  const pool = ['SWISS','Korean Air','KLM','Qatar Airways','Air France'];
  const lastSix = shuffle((() => { const out=[...pool]; while(out.length<6) out.push(pool[randInt(0,pool.length-1)]); return out; })());
  const carriers = [...firstSix, ...lastSix];

  const depTimes  = randomUniqueTimes(12);
  const durations = Array.from({length:12}, () => randInt(510, 720));  // 8.5–12h
  const prices    = Array.from({length:12}, () => randInt(900, 1100));

  const tzDelta =
    (countryOf(fromCode) === 'US' && countryOf(toCode) === 'JP') ? 360 :
    (countryOf(fromCode) === 'JP' && countryOf(toCode) === 'US') ? -360 : 0;

  return carriers.map((carrier, i) => {
    const depMins = depTimes[i];
    const dur     = durations[i];
    const arrMins = depMins + dur + tzDelta;
    return {
      from: fromCode, to: toCode,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur,
      durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(fromCode,toCode,carrier)
    };
  });
}

function buildRfdMlrResults(from,to){
  const carriers=['American Airlines','JetBlue','United',...shuffle(['American Airlines','United','JetBlue'])];
  const depTimes=randomUniqueTimes(6), durations=Array.from({length:6},()=>randInt(30,60)), prices=Array.from({length:6},()=>randInt(150,250));
  return carriers.map((c,idx)=>{const d=depTimes[idx],du=durations[idx],a=d+du;return{
    from,to,depart:minutesToTime(d),arrive:minutesToTime(a),
    plusOne:Math.floor(a/1440)>Math.floor(d/1440)?'+1':'',
    durationMin:du,durationText:`${Math.floor(du/60)}h ${String(du%60).padStart(2,'0')}m`,
    nonstop:true,price:prices[idx],carrier:c,overnight:overnightFlag(d,a),
    aircraft: pickAircraft(from,to,c)
  }});
}

/* RFD ↔ GRV (Grindavik) */
function buildRfdGrvResults(fromCode, toCode){
  const depMins = randInt(0, 1439);
  const dur     = randInt(360, 480); // 6–8h
  const tzDelta =
    (countryOf(fromCode) === 'US' && countryOf(toCode) === 'JP') ? 360 :
    (countryOf(fromCode) === 'JP' && countryOf(toCode) === 'US') ? -360 : 0;

  const arrMins = depMins + dur + tzDelta;
  const price   = randInt(850, 1100);

  return [{
    from: fromCode, to: toCode,
    depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
    plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
    durationMin: dur, durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
    nonstop: true, price, carrier: 'United',
    overnight: overnightFlag(depMins, arrMins),
    aircraft: pickAircraft(fromCode, toCode, 'United')
  }];
}

function buildPerIzoResults(from, to){
  const carriers = Array(4).fill('American Airlines');
  const depTimes  = randomUniqueTimes(4);
  const durations = Array.from({length:4}, () => randInt(30, 60));
  const prices    = Array.from({length:4}, () => randInt(150, 250));
  return carriers.map((carrier, i) => {
    const depMins = depTimes[i], dur = durations[i], arrMins = depMins + dur;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur,
      durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

function buildPerMlrResults(from, to){
  const carriers = ['American Airlines', 'JetBlue', 'United','Southwest', 'Delta', 'United'];
  const depTimes  = randomUniqueTimes(6);
  const durations = Array.from({length:6}, () => randInt(120, 180));
  const prices    = Array.from({length:6}, () => randInt(250, 600));
  return carriers.map((carrier, i) => {
    const depMins = depTimes[i], dur = durations[i], arrMins = depMins + dur;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur,
      durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

function buildPerLcaResults(from, to){
  const carriers = ['American Airlines', 'Delta', 'Delta','Spirit', 'United', 'American Airlines'];
  const depTimes  = randomUniqueTimes(6);
  const durations = Array.from({length:6}, () => randInt(120, 180));
  const prices    = Array.from({length:6}, () => randInt(250, 550));
  return carriers.map((carrier, i) => {
    const depMins = depTimes[i], dur = durations[i], arrMins = depMins + dur;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur,
      durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

function buildPerPhpResults(from, to){
  const carriers = ['American Airlines', 'Delta', 'United','Spirit', 'Southwest'];
  const depTimes  = randomUniqueTimes(5);
  const durations = Array.from({length:5}, () => randInt(120, 180));
  const prices    = Array.from({length:5}, () => randInt(250, 550));
  return carriers.map((carrier, i) => {
    const depMins = depTimes[i], dur = durations[i], arrMins = depMins + dur;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur,
      durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

function buildPerGrvResults(from, to){
  const carrier = 'Qantas';
  const depMins  = randomUniqueTimes(1)[0];
  const duration = randInt(600, 750);
  const tzDelta =
    (countryOf(from) === 'US' && countryOf(to) === 'JP') ? 360 :
    (countryOf(from) === 'JP' && countryOf(to) === 'US') ? -360 : 0;
  const arrMins = depMins + duration + tzDelta;
  const price   = randInt(950, 1200);
  return [{
    from, to,
    depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
    plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
    durationMin: duration,
    durationText: `${Math.floor(duration/60)}h ${String(duration%60).padStart(2,'0')}m`,
    nonstop: true, price, carrier,
    overnight: overnightFlag(depMins, arrMins),
    aircraft: pickAircraft(from, to, carrier)
  }];
}

function buildMlrIzoResults(from, to){
  const carriers = ['American Airlines', 'American Airlines', 'American Airlines','United', 'United', 'Delta'];
  const depTimes  = randomUniqueTimes(6);
  const durations = Array.from({length:6}, () => randInt(120, 180));
  const prices    = Array.from({length:6}, () => randInt(250, 600));
  return carriers.map((carrier, i) => {
    const depMins = depTimes[i], dur = durations[i], arrMins = depMins + dur;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur,
      durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

function buildMlrLcaResults(from, to){
  const carriers = ['Delta', 'Delta', 'United','Spirit', 'United', 'American Airlines'];
  const depTimes  = randomUniqueTimes(6);
  const durations = Array.from({length:6}, () => randInt(90, 120));
  const prices    = Array.from({length:6}, () => randInt(250, 550));
  return carriers.map((carrier, i) => {
    const depMins = depTimes[i], dur = durations[i], arrMins = depMins + dur;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur,
      durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

function buildMlrPhpResults(from, to){
  const carriers = ['American Airlines', 'United','Delta', 'United'];
  const depTimes  = randomUniqueTimes(4);
  const durations = Array.from({length:4}, () => randInt(90, 120));
  const prices    = Array.from({length:4}, () => randInt(250, 550));
  return carriers.map((carrier, i) => {
    const depMins = depTimes[i], dur = durations[i], arrMins = depMins + dur;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur,
      durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

function buildIzoLcaResults(from, to){
  const carriers = ['American Airlines', 'American Airlines', 'Delta','Delta', 'Delta', 'United'];
  const depTimes  = randomUniqueTimes(6);
  const durations = Array.from({length:6}, () => randInt(90, 120));
  const prices    = Array.from({length:6}, () => randInt(250, 550));
  return carriers.map((carrier, i) => {
    const depMins = depTimes[i], dur = durations[i], arrMins = depMins + dur;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur,
      durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

function buildIzoPhpResults(from, to){
  const carriers = ['American Airlines', 'American Airlines','Spirit', 'Spirit'];
  const depTimes  = randomUniqueTimes(4);
  const durations = Array.from({length:4}, () => randInt(90, 120));
  const prices    = Array.from({length:4}, () => randInt(250, 550));
  return carriers.map((carrier, i) => {
    const depMins = depTimes[i], dur = durations[i], arrMins = depMins + dur;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur,
      durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

function buildIzoHndResults(from, to){
  const carriers = ['American Airlines','American Airlines','American Airlines'];
  const fixedDepTimes = [18*60 + 45, 20*60 + 20, 23*60 + 40];
  const durations = Array.from({length:3}, () => randInt(420, 510));
  const prices = Array.from({length:3}, () => randInt(850, 1100));
  const tzDelta =
    (countryOf(from) === 'US' && countryOf(to) === 'JP') ? 360 :
    (countryOf(from) === 'JP' && countryOf(to) === 'US') ? -360 : 0;
  return carriers.map((carrier, i) => {
    const depMins = fixedDepTimes[i], dur = durations[i], arrMins = depMins + dur + tzDelta;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur, durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

function buildIzoGrvResults(from, to){
  const carrier = 'Lufthansa';
  const depMins  = 18*60 + 40;
  const dur      = randInt(660, 750);
  const tzDelta =
    (countryOf(from) === 'US' && countryOf(to) === 'JP') ? 360 :
    (countryOf(from) === 'JP' && countryOf(to) === 'US') ? -360 : 0;
  const arrMins = depMins + dur + tzDelta;
  const price   = randInt(900, 1200);
  return [{
    from, to,
    depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
    plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
    durationMin: dur,
    durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
    nonstop: true, price, carrier,
    overnight: overnightFlag(depMins, arrMins),
    aircraft: pickAircraft(from, to, carrier)
  }];
}

function buildLcaPhpResults(from, to){
  const carriers = Array(6).fill('Delta');
  const depTimes  = randomUniqueTimes(6);
  const durations = Array.from({length:6}, () => randInt(30, 60));
  const prices    = Array.from({length:6}, () => randInt(100, 250));
  return carriers.map((carrier, i) => {
    const depMins = depTimes[i], dur = durations[i], arrMins = depMins + dur;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur, durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

function buildLcaHndResults(from, to){
  const carriers = ['Delta', 'Singapore', 'Emirates'];
  const depTimes  = randomUniqueTimes(3);
  const durations = Array.from({length:3}, () => randInt(720, 960));
  const prices    = Array.from({length:3}, () => randInt(950, 1250));
  const tzDelta =
    (countryOf(from) === 'US' && countryOf(to) === 'JP') ? 360 :
    (countryOf(from) === 'JP' && countryOf(to) === 'US') ? -360 : 0;
  return carriers.map((carrier, i) => {
    const depMins = depTimes[i], dur = durations[i], arrMins = depMins + dur + tzDelta;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur, durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

function buildLcaGrvResults(from, to){
  const carrier = 'Delta';
  const depMins  = randomUniqueTimes(1)[0];
  const dur      = randInt(600, 660);
  const tzDelta =
    (countryOf(from) === 'US' && countryOf(to) === 'JP') ? 360 :
    (countryOf(from) === 'JP' && countryOf(to) === 'US') ? -360 : 0;
  const arrMins  = depMins + dur + tzDelta;
  const price    = randInt(900, 1150);
  return [{
    from, to,
    depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
    plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
    durationMin: dur, durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
    nonstop: true, price, carrier,
    overnight: overnightFlag(depMins, arrMins),
    aircraft: pickAircraft(from, to, carrier)
  }];
}

function buildHndGrvResults(from, to){
  const carriers = ['Lufthansa', 'CEBU Pacific', 'British Airways','Qatar Airways', 'Condor', 'easyJet'];
  const depTimes  = randomUniqueTimes(6);
  const durations = Array.from({length:6}, () => randInt(120, 180));
  const prices    = Array.from({length:6}, () => randInt(250, 600));
  const tzDelta =
    (countryOf(from) === 'US' && countryOf(to) === 'JP') ? 360 :
    (countryOf(from) === 'JP' && countryOf(to) === 'US') ? -360 : 0;
  return carriers.map((carrier, i) => {
    const depMins = depTimes[i], dur = durations[i], arrMins = depMins + dur + tzDelta;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur, durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

function buildHndSauResults(from, to){
  const carriers = ['SWISS', 'Qatar Airways', 'Lufthansa','British Airways', 'Condor', 'SWISS'];
  const depTimes  = randomUniqueTimes(6);
  const durations = Array.from({length:6}, () => randInt(180, 240));
  const prices    = Array.from({length:6}, () => randInt(250, 650));
  let tzDelta = 0;
  if (from === 'HND' && to === 'SAU') tzDelta = 60;
  else if (from === 'SAU' && to === 'HND') tzDelta = -60;
  return carriers.map((carrier, i) => {
    const depMins = depTimes[i], dur = durations[i], arrMins = depMins + dur + tzDelta;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur, durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

function buildGrvSauResults(from, to){
  const carriers = ['SWISS','SWISS','easyJet','easyJet'];
  const depTimes  = randomUniqueTimes(4);
  const durations = Array.from({length:4}, () => randInt(90, 150));
  const prices    = Array.from({length:4}, () => randInt(250, 550));
  let tzDelta = 0;
  if (from === 'GRV' && to === 'SAU') tzDelta = 60;
  else if (from === 'SAU' && to === 'GRV') tzDelta = -60;
  return carriers.map((carrier, i) => {
    const depMins = depTimes[i], dur = durations[i], arrMins = depMins + dur + tzDelta;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur, durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

function buildHndMlrResults(from, to){
  const carriers = ['Delta','American Airlines','United','Qatar Airways','Lufthansa'];
  const depTimes  = randomUniqueTimes(5);
  const durations = Array.from({length:5}, () => randInt(510, 720));
  const prices    = Array.from({length:5}, () => randInt(900, 1200));
  const tzDelta =
    (countryOf(from) === 'US' && countryOf(to) === 'JP') ? 360 :
    (countryOf(from) === 'JP' && countryOf(to) === 'US') ? -360 : 0;
  return carriers.map((carrier, i) => {
    const depMins = depTimes[i], dur = durations[i], arrMins = depMins + dur + tzDelta;
    return {
      from, to,
      depart: minutesToTime(depMins), arrive: minutesToTime(arrMins),
      plusOne: Math.floor(arrMins/1440) > Math.floor(depMins/1440) ? '+1' : '',
      durationMin: dur, durationText: `${Math.floor(dur/60)}h ${String(dur%60).padStart(2,'0')}m`,
      nonstop: true, price: prices[i], carrier,
      overnight: overnightFlag(depMins, arrMins),
      aircraft: pickAircraft(from, to, carrier)
    };
  });
}

/* -------------------- Results list (nonstop) -------------------- */
function resultsView(list){
  const div = document.createElement('div');
  div.className = 'results';

  list.forEach(opt => {
    const logo = logoFor(opt.carrier);
    const logoHTML = logo
      ? `<img class="airlogo ${opt.carrier==='easyJet' ? 'is-u2' : ''}" src="${logo}" alt="${opt.carrier} logo">`
      : '';

    const card = document.createElement('div');
    card.className = 'card-result';
    card.innerHTML = `
      <div class="row-top">
        <div class="pair">
          <div class="code">${opt.from}</div>
          <div class="arrow">→</div>
          <div class="code">${opt.to}</div>
        </div>
        <div class="right-price">
          <span>$${opt.price.toLocaleString()}</span>
          <svg viewBox="0 0 24 24">
            <path d="M9 6l6 6-6 6" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>

      <div class="row-top" style="margin-top:6px">
        <div class="timepair">
          ${opt.depart} &nbsp;→&nbsp; ${opt.arrive}
          ${opt.plusOne ? `<span class="plus1">${opt.plusOne}</span>` : ''}
        </div>
      </div>

      <div class="row-mid">
        ${logoHTML}
        <div class="row-mid-text">
          <div>Nonstop &nbsp;•&nbsp; ${opt.durationText}</div>
          <div class="carrier-line">${opt.carrier}</div>
        </div>
      </div>

      <div class="row-foot ${opt.overnight ? '' : 'hide'}">
        <svg width="16" height="16" viewBox="0 0 24 24">
          <path d="M12 9v4m0 4h.01M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2z" stroke="#ffcc66" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Overnight flight</span>
      </div>
    `;
    card.addEventListener('click', () => openSummary(opt));
    div.appendChild(card);
  });

  return div;
}

function renderView(title, node){
  routeTitle.textContent = title;
  sheetBody.innerHTML = '';
  sheetBody.appendChild(node);
}

/* -------------------- Steps -------------------- */
let lastSelection=null;

function openSummary(opt){
  lastSelection = {...opt, airlineCode: AIRLINE_CODES[opt.carrier] || ''};
  lastSelection.travelDate = document.getElementById('depart').value || '';
  const v=document.createElement('div'); v.className='view';

  const warn=opt.overnight?`
    <div class="panel" style="color:#ffcc66; display:flex; align-items:center; gap:8px">
      <svg width="16" height="16" viewBox="0 0 24 24"><path d="M12 9v4m0 4h.01M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2z" stroke="#ffcc66" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Overnight flight
    </div>`:'';

  v.innerHTML=`
    <div class="panel">
      <div style="font-weight:800; color:#21d07a; margin-bottom:6px">DEPART</div>
      <div style="font-size:17px; color:#e9eef4; margin-bottom:6px">${opt.from} to ${opt.to}</div>

      <div class="kv"><span><b>${opt.depart}</b> → <b>${opt.arrive}</b> ${opt.plusOne?'<span class="muted">+1</span>':''}</span><span>Nonstop</span></div>
      <div class="kv"><span>Duration</span><b>${opt.durationText}</b></div>
      <div class="kv"><span>Aircraft</span><b>${opt.aircraft || '—'}</b></div>
    </div>

    ${warn}
    <div class="panel"><div class="kv"><span>Total amount due</span><b>$${opt.price.toLocaleString()}</b></div></div>
    <button class="btn-lg" id="goPassengers">Continue</button>`;

  v.querySelector('#goPassengers').addEventListener('click',()=>openPassengers());
  if(!stepStack.length) openSheet();
  stepStack=[{title:'Your trip summary', html:v}];
  renderView('Your trip summary', v);
}

function openPassengers(){
  const intl=isIntl(lastSelection.from,lastSelection.to);
  const v=document.createElement('div'); v.className='view';
  const info=intl?`
    <div class="panel info">
      <div class="title">Know before you go</div>
      <div class="muted">International travel requires a valid passport. Check visa and travel document requirements for your destination.</div>
    </div>`:'';

  v.innerHTML=`
  ${info}
  <div class="panel"><div class="kv"><span>Your trip total</span><b>$${lastSelection.price.toLocaleString()}</b></div></div>

  <div class="panel">
    <h3>Passenger 1</h3>
    <div class="form-row">
      <div class="field"><label>First name •</label><input id="p1First" required type="text" placeholder="As on ID" autocomplete="given-name"></div>
      <div class="field"><label>Middle name</label><input id="p1Middle" type="text" placeholder="Optional" autocomplete="additional-name"></div>
      <div class="field"><label>Last name •</label><input id="p1Last" required type="text" placeholder="As on ID" autocomplete="family-name"></div>
    </div>
    <div class="form-row half" style="margin-top:8px">
      <div class="field"><label>Date of birth •</label><input id="p1Dob" required type="date" autocomplete="bday"></div>
      <div class="field"><label>Gender •</label>
        <select id="p1Gender" required autocomplete="sex"><option value="" disabled selected>Select</option><option>Female</option><option>Male</option><option>Unspecified</option></select>
      </div>
    </div>
  </div>

  <button class="btn-lg" id="goPay">Continue</button>`;
  
  v.querySelector('#goPay').addEventListener('click', () => {
    const first = (document.getElementById('p1First').value || '').trim();
    const middle = (document.getElementById('p1Middle').value || '').trim();
    const last = (document.getElementById('p1Last').value || '').trim();
    const dob = document.getElementById('p1Dob').value || '';
    const gender = document.getElementById('p1Gender').value || '';

    if(!first || !last || !dob || !gender){
      alert('Please complete required passenger fields.');
      return;
    }
    passengerData = { first, middle, last, dob, gender };
    openReviewPay();
  });

  stepStack.push({title:'Passenger details', html:v});
  renderView('Passenger details', v);
}

function openReviewPay(){
  const v = document.createElement('div'); 
  v.className = 'view';

  // build connection details if present
  let connHTML = '';
  if (Array.isArray(lastSelection.segments) && lastSelection.segments.length){
    connHTML = `<div class="hr"></div>` + lastSelection.segments.map(seg=>`
      <div class="kv" style="color:#cfd6dd">
        <span>${seg.from} → ${seg.to}</span>
        <b>${seg.depart} → ${seg.arrive} ${seg.plusOne?'<span class="muted">+1</span>':''}</b>
      </div>
      <div class="kv muted">
        <span>${seg.carrier}</span><b>${seg.aircraft || '—'}</b>
      </div>
    `).join('');
  }

  const showStops = Array.isArray(lastSelection.connections) ? '' : '<div class="kv"><span>Stops</span><b>Nonstop</b></div>';

  v.innerHTML = `
    <div class="panel">
      <div style="font-weight:800; margin-bottom:6px">Your trip</div>
      <div style="font-size:16px; margin-bottom:6px">${lastSelection.from} → ${lastSelection.to}</div>
      <div class="kv"><span><b>${lastSelection.depart}</b> → <b>${lastSelection.arrive}</b> ${lastSelection.plusOne?'<span class="muted">+1</span>':''}</span><span>${lastSelection.airlineCode||''}</span></div>
      <div class="kv"><span>Duration</span><b>${lastSelection.durationText}</b></div>
      ${showStops}
      <div class="kv"><span>Aircraft</span><b>${lastSelection.aircraft || '—'}</b></div>
      ${connHTML}
    </div>

    <div class="panel">
      <h3>Cost summary</h3>
      <div class="kv"><span>Economy</span><b>$${lastSelection.price.toLocaleString()}</b></div>
      <div class="kv" style="border-top:1px solid rgba(255,255,255,.1); padding-top:8px; margin-top:8px;">
        <span>Total amount due (All passengers)</span><b>$${lastSelection.price.toLocaleString()}</b>
      </div>
    </div>

    <div class="panel">
      <h3>Credit / debit card</h3>
      <div class="form-row">
        <div class="field"><label>Card number •</label><input id="ccNumber" type="text" inputmode="numeric" autocomplete="cc-number" placeholder="1234 5678 9012 3456"></div>
        <div class="form-row half">
          <div class="field"><label>Expiry date •</label><input id="ccExp" type="text" inputmode="numeric" autocomplete="cc-exp" placeholder="MM/YY"></div>
          <div class="field"><label>Security code •</label><input id="ccCvv" type="text" inputmode="numeric" autocomplete="cc-csc" placeholder="CVV" maxlength="4"></div>
        </div>
        <div class="field"><label>Billing address •</label><input type="text" autocomplete="address-line1" placeholder="Street address"></div>
        <div class="form-row half">
          <div class="field"><label>Cardholder name •</label><input id="ccName" type="text" autocomplete="cc-name" placeholder="Full name"></div>
          <div class="field"><label>Postal code •</label><input type="text" autocomplete="postal-code" placeholder="ZIP / Postal"></div>
        </div>
      </div>
      <label class="agree"><input id="agreeCheckbox" type="checkbox"><span>I agree to the terms and conditions, refund policy, and conditions of carriage.</span></label>
      <button class="btn-lg" id="btnPay">Pay now</button>
      <div class="muted" style="display:flex; align-items:center; gap:6px; margin-top:8px">
        <svg width="16" height="16" viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.25 3.438 10.063 9 12 5.563-1.938 9-6.75 9-12V5l-9-4z" fill="none" stroke="#9aa3af" stroke-width="1.5"/></svg>
        Secure checkout
      </div>
    </div>
  `;

  /* <-- attach the handler AFTER setting innerHTML */
  v.querySelector('#btnPay').addEventListener('click', handlePay);

  stepStack.push({title:'Review and pay', html:v});
  renderView('Review and pay', v);
}

function handlePay(){
  const agree = document.getElementById('agreeCheckbox')?.checked;
  const ccNumber = (document.getElementById('ccNumber')?.value || '').replace(/\s+/g,'');
  const ccExp = (document.getElementById('ccExp')?.value || '').trim();
  const ccCvv = (document.getElementById('ccCvv')?.value || '').trim();
  const ccName = (document.getElementById('ccName')?.value || '').trim();

  if(!ccNumber || !ccExp || !ccCvv || !ccName){
    alert('Please complete card details.');
    return;
  }
  if(!agree){
    alert('Please agree to the terms.');
    return;
  }
  showProcessing();
  setTimeout(showConfirmation, 3000);
}

function showProcessing(){
  const v = document.createElement('div'); v.className='view';
  v.innerHTML = `
    <div class="glass processing">
      <div class="spinner" aria-hidden="true"></div>
      <div style="font-weight:800; font-size:18px">Processing transaction</div>
      <div class="muted">Booking… please wait</div>
    </div>
  `;
  stepStack.push({title:'Processing…', html:v});
  renderView('Processing…', v);
}

function showConfirmation(){
  const p = passengerData || {};
  const fullName = [p.first, p.middle, p.last].filter(Boolean).join(' ');
  const bookingRef = randDigits(6);
  const ticketNo  = randDigits(13);

  // Save to Trips
saveTrip({
  id: Date.now() + '-' + randDigits(4),
  status: 'CONFIRMED',            // CONFIRMED → INFLIGHT → ARRIVED → ARCHIVED
  carrier: lastSelection.carrier || '',
  logo: logoFor(lastSelection.carrier || ''),
  from: lastSelection.from,
  to: lastSelection.to,
  date: lastSelection.travelDate || '',           // ISO date from your form
  schedDepart: lastSelection.depart,
  schedArrive: lastSelection.arrive,
  plusOne: !!lastSelection.plusOne,
  aircraft: lastSelection.aircraft || '—',
  price: lastSelection.price || 0,
  passenger: fullName || 'Passenger 1',

  depGate: '', depTerminal: '',
  arrGate: '', arrTerminal: '',
  isArchived: false
});
renderTrips();    // refresh Trips page if it's open

  const v = document.createElement('div'); v.className='view';
  v.innerHTML = `
    <div class="glass" style="padding:18px 16px 14px;">
      <div class="check-wrap" aria-hidden="true">
        <svg viewBox="0 0 24 24"><path d="M20 6L9 17l-5-5" stroke-width="2" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
      <div class="confirm-title" style="color:#63d488">Thank you for your purchase</div>
      <div class="confirm-sub">Your booking is confirmed</div>

      <div class="panel" style="margin-top:12px">
        <div class="kv"><span>Booking reference</span><b class="mono">${bookingRef}</b></div>
        <div class="kv"><span>e-Ticket number</span><b class="mono">${ticketNo}</b></div>
      </div>

      <div class="panel">
        <div class="kv"><span>Passenger</span><b>${fullName || 'Passenger 1'}</b></div>
        <div class="kv"><span>Route</span><b>${lastSelection.from} → ${lastSelection.to}</b></div>
        <div class="kv"><span>Date</span><b>${formatDate(lastSelection.travelDate)}</b></div>
        <div class="kv"><span>Times</span><b>${lastSelection.depart} → ${lastSelection.arrive} ${lastSelection.plusOne?'<span class="muted">+1</span>':''}</b></div>
        <div class="kv"><span>Carrier</span><b>${lastSelection.carrier || ''}</b></div>
        <div class="kv"><span>Amount paid</span><b>$${lastSelection.price.toLocaleString()}</b></div>
      </div>

      <div style="display:flex; gap:10px; margin-top:8px">
        <button class="btn-lg" style="flex:1" id="btnDone">Done</button>
      </div>
    </div>
  `;
  v.querySelector('#btnDone').addEventListener('click', () => { closeSheet(); });
  stepStack.push({title:'Booking confirmed', html:v});
  renderView('Booking confirmed', v);
}

/* -------------------- Search handler (nonstop routes only) -------------------- */
document.getElementById('btnSearch').addEventListener('click', () => {
  const from = fromSel.value, to = toSel.value;
  const departDate = document.getElementById('depart').value;

  if (!from || !to || !departDate) {
    const formCard = document.querySelector('.card');
    formCard.style.boxShadow = '0 0 0 4px rgba(255,80,80,.25)';
    setTimeout(()=>formCard.style.boxShadow = 'var(--shadow)', 350);
    return;
  }

  const key = [from, to].sort().join('-');

  let list;
  if (key==='PER-RFD') list=buildRfdPerResults(from,to);
  else if (key==='IZO-RFD') list=buildRfdIzoResults(from,to);
  else if (key==='LCA-RFD') list=buildRfdLcaResults(from,to);
  else if (key==='PHP-RFD') list=buildRfdPhpResults(from,to);
  else if (key==='HND-RFD') list=buildRfdHndResults(from,to);
  else if (key==='MLR-RFD') list=buildRfdMlrResults(from,to);
  else if (key==='GRV-RFD') list=buildRfdGrvResults(from,to);
  else if (key==='IZO-PER') list=buildPerIzoResults(from,to);
  else if (key==='MLR-PER') list=buildPerMlrResults(from,to);
  else if (key==='LCA-PER') list=buildPerLcaResults(from,to);
  else if (key==='PER-PHP') list=buildPerPhpResults(from,to);
  else if (key==='GRV-PER') list=buildPerGrvResults(from,to);
  else if (key==='IZO-MLR') list=buildMlrIzoResults(from,to);
  else if (key==='LCA-MLR') list=buildMlrLcaResults(from,to);
  else if (key==='MLR-PHP') list=buildMlrPhpResults(from,to);
  else if (key==='IZO-LCA') list=buildIzoLcaResults(from,to);
  else if (key==='IZO-PHP') list=buildIzoPhpResults(from,to);
  else if (key==='HND-IZO') list=buildIzoHndResults(from,to);
  else if (key==='GRV-IZO') list=buildIzoGrvResults(from,to);
  else if (key==='LCA-PHP') list=buildLcaPhpResults(from,to);
  else if (key==='HND-LCA') list=buildLcaHndResults(from,to);
  else if (key==='GRV-LCA') list=buildLcaGrvResults(from,to);
  else if (key==='GRV-HND') list=buildHndGrvResults(from,to);
  else if (key==='HND-SAU') list=buildHndSauResults(from,to);
  else if (key==='GRV-SAU') list=buildGrvSauResults(from,to);
  else if (key==='HND-MLR') list=buildHndMlrResults(from,to);
  else {
    const v=document.createElement('div'); v.className='view';
    v.innerHTML=`<div class="panel"><div class="kv"><span>Route</span><b>${from} → ${to}</b></div>
      <div class="muted">This prototype currently supports Rockford (RFD) ↔ Perth (PER), Rockford (RFD) ↔ Izolirani (IZO), Rockford (RFD) ↔ Larnaca (LCA), Rockford (RFD) ↔ Phaphos (PHP), and Rockford (RFD) ↔ Tokyo (HND).</div></div>`;
    openSheet(); renderView('Choose departure', v); stepStack=[{title:'Choose departure', html:v}];
    return;
  }

  const resNode = resultsView(list);
  openSheet(); renderView('Choose departure', resNode); stepStack=[{title:'Choose departure', html:resNode}];
});

  /* ---- Dock behavior ---- */
const dock = document.getElementById('dock');
const dockItems = dock.querySelectorAll('.dock-item');
const dockIndicator = dock.querySelector('.dock-indicator');

function setActiveTab(idx){
  dockItems.forEach(b => {
    b.classList.remove('active');
    b.removeAttribute('aria-current');
  });
  dockItems[idx].classList.add('active');
  dockItems[idx].setAttribute('aria-current','page');
  dockIndicator.style.transform = `translateX(${idx*100}%)`;
}

// click to switch highlight
dockItems.forEach((btn, idx) => {
  btn.addEventListener('click', () => {
    setActiveTab(idx);
    // TODO: if you later add a Trips screen, navigate here.
    // e.g., openTrips();
  });
});

// default tab on load
setActiveTab(0);

  /* ---------- Simple screen switcher with a smooth fade ---------- */
function showScreen(id){
  const next = document.getElementById(id);
  const curr = document.querySelector('.screen.show');

  if (curr === next) return;

  // show next
  next.style.display = 'block';
  // force reflow so transition runs
  next.getBoundingClientRect();
  next.classList.add('show');

  // hide current after transition
  if (curr){
    curr.classList.remove('show');
    setTimeout(()=>{ if(!curr.classList.contains('show')) curr.style.display = 'none'; }, 300);
  }
}

// wire dock buttons to screens
const dockBookingBtn = document.querySelector('.dock .dock-item[data-tab="booking"]');
const dockTripsBtn   = document.querySelector('.dock .dock-item[data-tab="trips"]');

function openBooking(){ setActiveTab(0); showScreen('screen-booking'); }
function openTrips(){ setActiveTab(1); showScreen('screen-trips'); }

dockBookingBtn.addEventListener('click', openBooking);
dockTripsBtn.addEventListener('click', openTrips);

// default
showScreen('screen-booking');

  /* ---------- Trips list ---------- */
function tripCardHTML(t, isArchived = false){
  const pillLabel = t.status === 'INFLIGHT' ? 'INFLIGHT'
                  : t.status === 'ARRIVED'  ? 'ARRIVED'
                  : 'ON TIME';

  const pillClass = t.status === 'INFLIGHT' ? 'pill-inflight'
                   : t.status === 'ARRIVED'  ? 'pill-arrived'
                   : 'pill-ontime';

  return `
    <div class="trip-card" data-id="${t.id}">
      <img class="trip-logo" alt="" src="${t.logo || ''}">
      <div class="trip-body">
        <div class="trip-times">
          <b>${t.schedDepart}</b>
          &nbsp;→&nbsp;
          <b>${t.schedArrive}${t.plusOne ? ' <span class="muted">+1</span>' : ''}</b>
        </div>
        <div class="trip-route">${t.from} &nbsp;→&nbsp; ${t.to}</div>
        <div class="trip-date">${formatDate(t.date)}</div>
      </div>

      <div class="trip-right">
        <span class="pill ${pillClass}">${pillLabel}</span>
        ${isArchived ? `<button class="mini-btn red btn-delete" type="button">Delete</button>` : ``}
      </div>
    </div>`;
}

function renderTrips(){
  const trips = getTrips();
  const upcoming = trips.filter(t => !t.isArchived);
  const previous = trips.filter(t => t.isArchived);

  const up = document.getElementById('upcomingList');
  const prev = document.getElementById('previousList');
  const empty = document.getElementById('upcomingEmpty');

  up.innerHTML = upcoming.map(t => tripCardHTML(t, false)).join('');
  prev.innerHTML = previous.map(t => tripCardHTML(t, true)).join('');

  empty.style.display = upcoming.length ? 'none' : '';
}

document.getElementById('upcomingList').addEventListener('click', e=>{
  const card = e.target.closest('.trip-card'); if(card) openTripDetail(card.dataset.id);
});
document.getElementById('previousList').addEventListener('click', e=>{
  const del = e.target.closest('.btn-delete');
  if (del){
    e.stopPropagation();
    const card = e.target.closest('.trip-card');
    if(card) confirmDelete(card.dataset.id);
    return;
  }
  const card = e.target.closest('.trip-card');
  if(card) openTripDetail(card.dataset.id);
});

  function airportTitle(code){
  const a = AIRPORTS.find(x=>x.code===code);
  // strip "(XXX)" from the end
  const n = (a?.name || code).replace(/\s*\([A-Z]{3}\)\s*$/,'');
  return `${code} • ${n}`;
}
function diffMins(a, b){ return timeStrToMins(a) - timeStrToMins(b); } // + = late, - = early

function openTripDetail(id){
  const trips = getTrips();
  const i = trips.findIndex(t => t.id === id);
  if (i < 0) return;
  const t = trips[i];

  // helpers local to this view
  function airportTitle(code){
    const a = AIRPORTS.find(x => x.code === code);
    const n = (a?.name || code).replace(/\s*\([A-Z]{3}\)\s*$/,'');
    return `${code} • ${n}`;
  }
  function diffMins(a, b){ return timeStrToMins(a) - timeStrToMins(b); } // + late, - early

  // which time to show (actual overrides scheduled)
  const depShown = t.actualDepart || t.schedDepart;
  const arrShown = t.actualArrive || t.schedArrive;

  // minute deltas when actuals exist
  const dDiff = t.actualDepart ? diffMins(t.actualDepart, t.schedDepart) : 0;
  const aDiff = t.actualArrive ? diffMins(t.actualArrive, t.schedArrive) : 0;

  // color classes for NEW times only
  const depClass = t.actualDepart ? (dDiff < 0 ? 'time-early' : dDiff > 0 ? 'time-late' : '') : '';
  const arrClass = t.actualArrive ? (aDiff < 0 ? 'time-early' : aDiff > 0 ? 'time-late' : '') : '';

  const v = document.createElement('div');
  v.className = 'view tdetail';

  v.innerHTML = `
    <div class="updated">Updated now</div>
    <div class="route">${t.from} &nbsp;→&nbsp; ${t.to}</div>

    <!-- Airline header -->
    <div class="tcard">
      <div class="trow">
        <img src="${t.logo || ''}" alt="" class="trip-logo" style="width:38px;height:38px;border-radius:10px;background:#13151a">
        <div>
          <div class="airline">${t.carrier || ''}</div>
          <div class="sub">${t.from} → ${t.to}</div>
        </div>
        <span class="pill ${t.status==='INFLIGHT'?'pill-inflight':t.status==='ARRIVED'?'pill-arrived':'pill-ontime'}">
          ${t.status==='INFLIGHT'?'INFLIGHT':t.status==='ARRIVED'?'ARRIVED':'ON TIME'}
        </span>
      </div>
    </div>

    <!-- Depart -->
    <div class="tcard section">
      <div class="headrow" style="display:flex;align-items:center;justify-content:space-between;gap:12px">
        <div class="airport">⦿ ${airportTitle(t.from)}</div>
        ${
          (t.depGate || t.depTerminal)
          ? `<div class="gatebox">
               ${t.depGate ? `<span class="gatepill">${t.depGate}</span>` : ``}
               ${t.depTerminal ? `<div class="term">${/^terminal/i.test(t.depTerminal) ? t.depTerminal : 'Terminal ' + t.depTerminal}</div>` : ``}
             </div>`
          : ``
        }
      </div>

      <div class="bigtime">
        <span class="${depClass}">${depShown}</span>
        ${t.actualDepart ? `<span class="sched-old">${t.schedDepart}</span>` : ''}
      </div>

      ${
        t.actualDepart
          ? `<div class="delta ${dDiff>0?'late':dDiff<0?'early':''}">
               ${dDiff===0 ? 'On Time' : `${Math.abs(dDiff)}m ${dDiff>0?'Late':'Early'}`}
             </div>`
          : ''
      }

      <div class="sub" style="margin-top:10px">${t.durationText ? `${t.durationText} • Nonstop` : ''}</div>
    </div>

    <!-- Arrive -->
    <div class="tcard section">
      <div class="headrow" style="display:flex;align-items:center;justify-content:space-between;gap:12px">
        <div class="airport">⦿ ${airportTitle(t.to)}</div>
        ${
          (t.arrGate || t.arrTerminal)
          ? `<div class="gatebox">
               ${t.arrGate ? `<span class="gatepill">${t.arrGate}</span>` : ``}
               ${t.arrTerminal ? `<div class="term">${/^terminal/i.test(t.arrTerminal) ? t.arrTerminal : 'Terminal ' + t.arrTerminal}</div>` : ``}
             </div>`
          : ``
        }
      </div>

      <div class="bigtime">
        <span class="${arrClass}">${arrShown}${t.plusOne ? ' <sup class="muted">+1</sup>' : ''}</span>
        ${t.actualArrive ? `<span class="sched-old">${t.schedArrive}${t.plusOne ? ' +1':''}</span>` : ''}
      </div>

      ${
        t.actualArrive
          ? `<div class="delta ${aDiff>0?'late':aDiff<0?'early':''}">
               ${aDiff===0 ? 'On Time' : `${Math.abs(aDiff)}m ${aDiff>0?'Late':'Early'}`}
             </div>`
          : ''
      }

      <div class="tfooter">
        <div class="kv"><span>Aircraft</span><b>${t.aircraft || '—'}</b></div>
        <div class="kv"><span>Passenger</span><b>${t.passenger || 'Passenger 1'}</b></div>
      </div>
    </div>

    <div style="height:6px"></div>
    <button class="btn-lg" id="btnStatus">Status</button>
  `;

  v.querySelector('#btnStatus').addEventListener('click', () => openStatusActions(t));

  openSheet();
  renderView(`${t.from} → ${t.to}`, v);
  stepStack = [{ title: `${t.from} → ${t.to}`, html: v }];
}

/* ---------- Status Action Sheet ---------- */
function openStatusActions(trip){
  const back = document.createElement('div'); back.className='actions-backdrop';
  const box  = document.createElement('div'); box.className='actions';

  function close(){
    back.classList.remove('show'); box.classList.remove('show');
    document.body.classList.remove('modal-open');
    setTimeout(()=>{ back.remove(); box.remove(); }, 200);
  }
  back.addEventListener('click', close);

  document.body.append(back, box);
  requestAnimationFrame(()=>{ back.classList.add('show'); box.classList.add('show'); document.body.classList.add('modal-open'); });

  const st = trip.status;
  let html = '';

  // --- status-changing rows (same as before)
  if(st==='CONFIRMED'){
    html += `
      <div class="row"><button class="btn" id="toInflight">Change to INFLIGHT</button></div>
      <div class="row" id="depRow" style="display:none">
        <div class="muted">Enter actual departure time</div>
        <input id="depTime" type="time">
        <button class="btn" id="upd1">Update status</button>
      </div>`;
  } else if(st==='INFLIGHT'){
    html += `
      <div class="row"><button class="btn" id="toArrived">Change status to ARRIVED</button></div>
      <div class="row" id="arrRow" style="display:none">
        <div class="muted">Enter actual arrival time</div>
        <input id="arrTime" type="time">
        <button class="btn" id="upd2">Update status</button>
      </div>`;
  } else if(st==='ARRIVED'){
    html += `<div class="row"><button class="btn red" id="archive">Archive flight</button></div>`;
  }

  // --- NEW: Change gate flow (always present)
  html += `
    <div class="row"><button class="btn" id="chgGate">Change gate</button></div>
    <div class="row" id="gateMode" style="display:none">
      <div style="display:flex; gap:8px">
        <button class="btn" id="gateDep">Departure</button>
        <button class="btn" id="gateArr">Arrival</button>
      </div>
      <div id="gateForm" style="display:none">
        <input id="gateInput" type="text" placeholder="Gate (e.g., D12)">
        <input id="termInput" type="text" placeholder="Terminal (e.g., Main)">
        <button class="btn" id="saveGate">Save</button>
      </div>
    </div>
  `;

  box.innerHTML = html;

  // status handlers (unchanged behavior)
  if(st==='CONFIRMED'){
    box.querySelector('#toInflight').addEventListener('click', ()=> box.querySelector('#depRow').style.display='grid');
    box.querySelector('#upd1').addEventListener('click', ()=>{
      const v = box.querySelector('#depTime').value; if(!v) return;
      const [H,M]=v.split(':').map(Number); const ampm=H>=12?'PM':'AM'; const h12=((H+11)%12)+1; const disp=`${h12}:${String(M).padStart(2,'0')} ${ampm}`;
      const trips=getTrips(); const i=trips.findIndex(t=>t.id===trip.id);
      if(i>-1){ trips[i].status='INFLIGHT'; trips[i].actualDepart=disp; setTrips(trips); }
      close(); openTripDetail(trip.id); renderTrips();
    });
  } else if(st==='INFLIGHT'){
    box.querySelector('#toArrived').addEventListener('click', ()=> box.querySelector('#arrRow').style.display='grid');
    box.querySelector('#upd2').addEventListener('click', ()=>{
      const v = box.querySelector('#arrTime').value; if(!v) return;
      const [H,M]=v.split(':').map(Number); const ampm=H>=12?'PM':'AM'; const h12=((H+11)%12)+1; const disp=`${h12}:${String(M).padStart(2,'0')} ${ampm}`;
      const trips=getTrips(); const i=trips.findIndex(t=>t.id===trip.id);
      if(i>-1){ trips[i].status='ARRIVED'; trips[i].actualArrive=disp; setTrips(trips); }
      close(); openTripDetail(trip.id); renderTrips();
    });
  } else if(st==='ARRIVED'){
    box.querySelector('#archive').addEventListener('click', ()=>{
      const trips=getTrips(); const i=trips.findIndex(t=>t.id===trip.id);
      if(i>-1){
        trips[i].status = 'ARRIVED';     // <— keep ARRIVED label
        trips[i].isArchived = true;      // <— move to Previous Trips
        setTrips(trips);
      }
      close(); closeSheet(); renderTrips();
    });
  }

  // --- NEW: change gate handlers
  const gateMode = box.querySelector('#gateMode');
  const gateForm = box.querySelector('#gateForm');
  box.querySelector('#chgGate').addEventListener('click', ()=> gateMode.style.display='grid');

  let gateKind = ''; // 'dep' or 'arr'
  box.querySelector('#gateDep').addEventListener('click', ()=> { gateKind='dep'; gateForm.style.display='grid'; });
  box.querySelector('#gateArr').addEventListener('click', ()=> { gateKind='arr'; gateForm.style.display='grid'; });

  box.querySelector('#saveGate').addEventListener('click', ()=>{
    const gate = box.querySelector('#gateInput').value.trim();
    const term = box.querySelector('#termInput').value.trim();
    if(!gate && !term) return;
    const trips=getTrips(); const i=trips.findIndex(t=>t.id===trip.id);
    if(i>-1){
      if(gateKind==='dep'){ trips[i].depGate = gate; trips[i].depTerminal = term; }
      else                { trips[i].arrGate = gate; trips[i].arrTerminal = term; }
      setTrips(trips);
    }
    close(); openTripDetail(trip.id); renderTrips();
  });
}

  document.body.appendChild(back); document.body.appendChild(box);
  requestAnimationFrame(()=>{ back.classList.add('show'); box.classList.add('show'); });
}

/* render Trips on load */
renderTrips();

  function confirmDelete(tripId){
  const back = document.createElement('div'); back.className = 'confirm-backdrop';
  const box  = document.createElement('div'); box.className  = 'confirm';

  box.innerHTML = `
    <h3>Delete this flight?</h3>
    <p>This will permanently remove it from Previous Trips.</p>
    <div class="row-btns">
      <button class="btn-outline" id="delCancel" type="button">Cancel</button>
      <button class="btn-danger"  id="delConfirm" type="button">Delete</button>
    </div>
  `;

  function close(){
    back.classList.remove('show'); box.classList.remove('show');
    document.body.classList.remove('modal-open');
    setTimeout(()=>{ back.remove(); box.remove(); }, 200);
  }

  back.addEventListener('click', close);
  box.querySelector('#delCancel').addEventListener('click', close);
  box.querySelector('#delConfirm').addEventListener('click', ()=>{
    const arr = getTrips().filter(t => t.id !== tripId);
    setTrips(arr);
    close();
    renderTrips();
  });

  document.body.append(back, box);
  requestAnimationFrame(()=>{ back.classList.add('show'); box.classList.add('show'); });
  document.body.classList.add('modal-open'); // locks background + dock
}

</script>
</body>
</html>
